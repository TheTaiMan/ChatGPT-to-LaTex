<!DOCTYPE html>
<html>
  <head>
    <title>LaTeX to Markdown Converter</title>
    <script>
      function convertLatexToMarkdown() {
        // Get the text from the text area
        let inputText = document.getElementById('inputText').value

        // Function to replace inline math
        function replaceInlineMath(text) {
          return text.replace(/\\\((.*?)\\\)/g, (match, p1) => `$${p1.trim()}$`)
        }

        // Function to replace display math
        function replaceDisplayMath(text) {
          return text.replace(/\\\[([\s\S]*?)\\\]/g, (match, p1) => {
            // Trim each line and join with a single space
            let inner = p1
              .split('\n')
              .map((line) => line.trim())
              .join(' ')
              .trim()
            return `$$${inner}$$`
          })
        }

        // Process the text line by line
        let lines = inputText.split('\n')
        let inDisplayMath = false
        let displayMathContent = ''
        let convertedLines = []

        for (let i = 0; i < lines.length; i++) {
          let line = lines[i]

          if (inDisplayMath) {
            if (line.includes('\\]')) {
              // End of display math block
              inDisplayMath = false
              displayMathContent += line.split('\\]')[0]
              let convertedMath = replaceDisplayMath(
                '\\[' + displayMathContent + '\\]'
              )
              displayMathContent = ''
              convertedLines.push(
                convertedMath + replaceInlineMath(line.split('\\]')[1])
              )
            } else {
              // Continue collecting display math content
              displayMathContent += line + '\n'
            }
          } else if (line.includes('\\[')) {
            // Start of display math block
            inDisplayMath = true
            displayMathContent = line.split('\\[')[1] + '\n'
            let prefix = replaceInlineMath(line.split('\\[')[0])
            if (prefix.trim() !== '') {
              convertedLines.push(prefix)
            }
          } else {
            // Regular line, just replace inline math
            convertedLines.push(replaceInlineMath(line))
          }
        }

        // Join the converted lines
        let convertedText = convertedLines.join('\n')

        // Display the converted text in the output div
        document.getElementById('output').innerText = convertedText
      }

      function copyToClipboard() {
        let outputText = document.getElementById('output').innerText
        navigator.clipboard.writeText(outputText)
      }
    </script>
  </head>
  <body>
    <h1>LaTeX to Markdown Converter</h1>
    <textarea id="inputText" rows="15" cols="80"></textarea><br />
    <button onclick="convertLatexToMarkdown()">Convert</button>
    <pre
      id="output"
      style="
        white-space: pre-wrap;
        word-wrap: break-word;
        background-color: #f0f0f0;
        padding: 10px;
        border: 1px solid #ccc;
      "
    ></pre>
    <button onclick="copyToClipboard()">Copy Output</button>
  </body>
</html>
